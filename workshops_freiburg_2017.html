<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Miguel Alvarez" />

<meta name="date" content="2017-03-09" />

<title>Introduction to the package vegtable</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles_workshops.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Miguel Alvarez</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="workshops.html">Workshops</a>
</li>
<li>
  <a href="art.html">Art Gallery</a>
</li>
<li>
  <a href="news.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.ipe.uni-bonn.de/pflanzenernaehrung/mitarbeiter/m_alvarez">
    <span class="fa fa-university"></span>
     
  </a>
</li>
<li>
  <a href="https://www.researchgate.net/profile/Miguel_Alvarez18">RG</a>
</li>
<li>
  <a href="https://www.github.com/kamapu">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://gis.stackexchange.com/users/80385/migue-lo?tab=profile">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/miguel-alvarez-49559b145">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
<li>
  <a href="https://www.facebook.com/miguelypunto">
    <span class="fa fa-facebook-official"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<div><img src="images/bar_workshops_freiburg_2017.png" width="1000px" align="top"></div>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Introduction to the package vegtable</h1>
<h4 class="author"><em>Miguel Alvarez</em></h4>
<h4 class="date"><em>2017-03-09</em></h4>

</div>


<div id="first-steps" class="section level1">
<h1><span class="header-section-number">1</span> First Steps</h1>
<p>The workshop deals with the management and process of taxonomic lists and retrieving information from vegetation-plot databases. Besides <strong>Microsoft Office</strong> (for the exploration of spreadsheets), following software will be required for the session:</p>
<ul>
<li><a href="https://www.r-project.org/">R</a></li>
<li><a href="https://www.rstudio.com/">RStudio</a></li>
<li><a href="https://www.synbiosys.alterra.nl/turboveg/">Turboveg</a></li>
<li><a href="http://www.sci.muni.cz/botany/juice/">Juice</a></li>
<li><a href="https://www.google.com/earth/">Google Earth</a></li>
</ul>
<div id="installation-of-requirements-in-r" class="section level2">
<h2><span class="header-section-number">1.1</span> Installation of requirements in R</h2>
<p>Though all required R-packages will be installed in the computer room previous to this session, here are these instructions, in the case you try to repeat the sessions in your own computer. Following command line should be executed in order to install all required packages in <code>R</code>:</p>
<pre class="r"><code>install.packages(c(&quot;devtools&quot;,&quot;foreign&quot;,&quot;plotKML&quot;,&quot;rgdal&quot;,&quot;sp&quot;,&quot;vegdata&quot;,
    &quot;vegan&quot;, &quot;xlsx&quot;), dependencies=TRUE)</code></pre>
<p>This session will focus on the use of two packages that use <a href="https://github.com/">GitHub</a> as repository for sharing and developmen. The package <a href="https://github.com/kamapu/taxlist">taxlist</a> processes taxonomic lists that may be connected to biodiversity information (e.g. vegetation relevés), while the package <a href="https://github.com/kamapu/vegtable">vegtable</a> has a similar task but handling vegetation-plot records. Since <code>vegtable</code> is depending on <code>taxlist</code>, both packages should be installed and updated for this session:</p>
<pre class="r"><code>library(devtools)
install_github(&quot;kamapu/taxlist&quot;)
install_github(&quot;kamapu/vegtable&quot;)</code></pre>
</div>
<div id="documents-and-data-sets" class="section level2">
<h2><span class="header-section-number">1.2</span> Documents and data sets</h2>
<p>This is the main document of the Workshop and will be distributed among its participants. Additionally, data sets required for the examples are provided by the installation of the R-packages <code>taxlist</code> and <code>vegtable</code>.</p>
</div>
</div>
<div id="introduction-to-taxlist" class="section level1">
<h1><span class="header-section-number">2</span> Introduction to taxlist</h1>
<p>The package <code>taxlist</code> define an homonymous <code>S4</code> class. Among other properties, <code>S4</code> classes implement a formal definition of objects, tests for their validation and functions (methods) applied to them. Such properties are suitable for structure information of taxonomic lists and for data handling.</p>
<pre class="r"><code>library(taxlist)
showClass(&quot;taxlist&quot;)</code></pre>
<p>This class is composed by four slots, corresponding to column-oriented tables (class <code>data.frame</code> in <strong>R</strong>). While the slots <code>taxonNames</code> and <code>taxonRelations</code> contain the information on names (labels of taxon concepts) and taxon concepts, respectively, representing the core information of taxonomic lists.</p>
<p>most important information regarding taxa (taxon concepts), information in slots <code>taxonTraits</code> and <code>taxonViews</code> is optional and they can be empty.</p>
<div id="building-taxlist-objects" class="section level2">
<h2><span class="header-section-number">2.1</span> Building taxlist objects</h2>
<p>Building <code>taxlist</code> objects can be achieved either through a step-by-step routine working with small building blocks or by importing consolidated data sets.</p>
<div id="using-character-vectors" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Using character vectors</h3>
<p>Objects of class <code>taxlist</code> can be just built from a list of names formatted as a character vector. To achieve it, the functions <code>new</code> and <code>add_concept</code> are required.</p>
<pre class="r"><code>plants &lt;- c(&quot;Lactuca sativa&quot;,&quot;Solanum tuberosum&quot;,&quot;Triticum sativum&quot;)
splist &lt;- new(&quot;taxlist&quot;)
splist &lt;- add_concept(splist, plants)
summary(splist)</code></pre>
</div>
<div id="using-formatted-tables" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Using formatted tables</h3>
<p>In the case of consolidated species lists, they can be inserted in a table previously formatted for <code>taxlist</code> (or <strong>Turboveg</strong>). Such tables can include both, accepted names for plant species as well as their respective synonyms. A formatted table is installed in the package <code>taxlist</code>.</p>
<pre class="r"><code>File &lt;- file.path(path.package(&quot;taxlist&quot;), &quot;cyperus&quot;, &quot;names.csv&quot;)
Cyperus &lt;- read.csv(File, stringsAsFactors=FALSE)
str(Cyperus)</code></pre>
<p>This table was originally imported form <strong>Turboveg</strong> and inherits some of its default columns. Four columns were renamed and are mandatory for process the table with the function <code>df2taxlist</code>:</p>
<ul>
<li><code>TaxonUsageID</code> is the key field of a table of names (slot <code>taxonNames</code>).</li>
<li><code>TaxonConceptID</code> is the link of the name to its respective concept (key field in slot <code>taxonRelations</code>.</li>
<li><code>TaxonName</code> is the name itself as character.</li>
<li><code>AuthorName</code> is a character value indicating the author(s) of the respective name.</li>
</ul>
<p>Additionally the functions require a logical vector indicating, which of those names should be considered as synonyms or accepted names for its respective concept. This information is provided by the inverse value of the column <code>SYNONYM</code> in <strong>Turboveg</strong>.</p>
<pre class="r"><code>Cyperus &lt;- df2taxlist(Cyperus, !Cyperus$SYNONYM)
summary(Cyperus)</code></pre>
<pre><code>## object size: 29.7 Kb 
## validation of &#39;taxlist&#39; object: TRUE 
## 
## number of names: 95 
## number of concepts: 42 
## trait entries: 0 
## reference entries: 0</code></pre>
</div>
<div id="using-turboveg-species-list" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Using Turboveg species list</h3>
<p>A direct import from a <strong>Turboveg</strong> database can be done using the function <code>tv2taxlist</code>. The installation of <code>vegtable</code> includes data published by <strong>Fujiwara et al. (2014)</strong> with vegetation plots collected in forest stands from Kenya.</p>
<pre class="r"><code>library(vegtable)</code></pre>
<pre><code>## This is vegtable 0.1.0</code></pre>
<pre><code>## 
## Attaching package: &#39;vegtable&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     transform</code></pre>
<pre class="r"><code>tv_home &lt;- file.path(path.package(&quot;vegtable&quot;), &quot;tv_data&quot;)
Fujiwara &lt;- tv2taxlist(&quot;Fujiwara_sp&quot;, tv_home)
summary(Fujiwara)</code></pre>
</div>
</div>
<div id="summary-displays" class="section level2">
<h2><span class="header-section-number">2.2</span> Summary displays</h2>
<p>For <code>taxlist</code> objects there are basically two ways for displaying summaries. The first way is just ot apply the function <code>summary</code> to a <code>taxlist</code> object:</p>
<pre class="r"><code>summary(Cyperus)</code></pre>
<pre><code>## object size: 29.7 Kb 
## validation of &#39;taxlist&#39; object: TRUE 
## 
## number of names: 95 
## number of concepts: 42 
## trait entries: 0 
## reference entries: 0</code></pre>
<p>Note that this option also executes a validity check of the object, as done by the function <code>validObject</code>.</p>
<p>The second way is getting information on a particular concept by adding it concept ID in the second argument of the function.</p>
<pre class="r"><code>summary(Cyperus, 197)</code></pre>
<pre><code>## ------------------------------ 
## concept ID: 197 
## view ID: none 
## level: none 
## parent: none 
## 
## # accepted name: 
## 197 Cyperus dives Delile 
## 
## # synonyms (5): 
## 52000 Cyperus immensus C.B. Clarke 
## 52600 Cyperus exaltatus var. dives (Delile) C.B. Clarke 
## 52601 Cyperus alopecuroides var. dives Boeckeler 
## 52602 Cyperus immensus var. petherickii (C.B. Clarke) Kük. 
## 52603 Cyperus petherickii C.B. Clarke 
## ------------------------------</code></pre>
<p>Specific information for several concepts can be displayed by using a vector with several concept IDs. Through the option <code>ConceptID=&quot;all&quot;</code> it is also possible to get a display of the first concepts, depending on the value of the argument <code>maxsum</code>.</p>
<pre class="r"><code>summary(Cyperus, &quot;all&quot;, maxsum=10)</code></pre>
</div>
<div id="example-data-set" class="section level2">
<h2><span class="header-section-number">2.3</span> Example data set</h2>
<p>The installation of <code>taxlist</code> includes the data <code>Easplist</code>, which is formatted as a <code>taxlist</code> object. This data is a subset of the species list used by the database <strong>SWEA-Dataveg</strong> (<a href="http://www.givd.info/ID/AF-00-006" title="SWEA-Dataveg">GIVD ID AF-006</a>):</p>
<pre class="r"><code>data(Easplist)
summary(Easplist)</code></pre>
</div>
<div id="access-to-slots" class="section level2">
<h2><span class="header-section-number">2.4</span> Access to slots</h2>
<p>The common ways to access to the content of slots in <code>S4</code> objects are either using the function <code>slot(object, name)</code> or the symbol <code>@</code> (i.e. <code>object@name</code>). Additional functions, which are specific for <code>taxlist</code> objects are <code>taxon_names</code>, <code>taxon_relations</code>, <code>taxon_traits</code> and <code>taxon_views</code> (see the help documentation).</p>
<p>Additionally, it is possible to use the methods <code>$</code> and <code>[</code> , the first for access to information in the slot <code>taxonTraits</code>, while the second can be also used for other slots in the object.</p>
<pre class="r"><code>summary(as.factor(Easplist$LifeForm))</code></pre>
<pre><code>## Ch  H Hy  T 
##  5  7  3 36</code></pre>
</div>
<div id="subsets" class="section level2">
<h2><span class="header-section-number">2.5</span> Subsets</h2>
<p>Methods for the function <code>subset</code> are implemented in order to generate subsets of the content of <code>taxlist</code> objects. Such subsets usually apply pattern matching (for character vectors) or logical operations and are analogous to query building in relational databases. The <code>subset</code> method can be apply to any slot by setting the value of the argument <code>slot</code>.</p>
<pre class="r"><code>Papyrus &lt;- subset(Easplist, grepl(&quot;papyrus&quot;, TaxonName), slot=&quot;names&quot;)
summary(Papyrus, &quot;all&quot;)</code></pre>
<p>Or the very same results:</p>
<pre class="r"><code>Papyrus &lt;- subset(Easplist, TaxonConceptID == 206, slot=&quot;relations&quot;)
summary(Papyrus, &quot;all&quot;)</code></pre>
<p>Similarly, you can look for a specific name.</p>
<pre class="r"><code>Phraaus &lt;- subset(Easplist, charmatch(&quot;Phragmites australis&quot;, TaxonName),
    slot=&quot;names&quot;)
summary(Phraaus, &quot;all&quot;)</code></pre>
</div>
<div id="parent-child-relationships" class="section level2">
<h2><span class="header-section-number">2.6</span> Parent-child relationships</h2>
<p>Objects belonging to the class <code>taxlist</code> can optionally content parent-child relationships and taxonomic levels. Such information is also included in the data <code>Easplist</code>, as shown in the summary output.</p>
<pre class="r"><code>summary(Easplist)</code></pre>
<pre><code>## object size: 739.8 Kb 
## validation of &#39;taxlist&#39; object: TRUE 
## 
## number of names: 5337 
## number of concepts: 3935 
## trait entries: 51 
## reference entries: 2 
## 
## concepts with parents: 3745 
## concepts with children: 1214 
## 
## hierarchical levels: form &lt; variety &lt; subspecies &lt; species &lt; genus &lt; family 
## number of concepts in level form: 1
## number of concepts in level variety: 110
## number of concepts in level subspecies: 81
## number of concepts in level species: 2528
## number of concepts in level genus: 1025
## number of concepts in level family: 189</code></pre>
<p>Note that such information can get lost once applied <code>subset</code>, since the respective parents or children from the original data set are not anymore in the subset. May you like to recover parents and children, you can use the functions <code>get_paretns</code> or <code>get_children</code>, respectively.</p>
<pre class="r"><code>summary(Papyrus, &quot;all&quot;)</code></pre>
<pre><code>## ------------------------------ 
## concept ID: 206 
## view ID: 1 
## level: species 
## parent: none 
## 
## # accepted name: 
## 206 Cyperus papyrus L. 
## 
## # synonyms (2): 
## 52612 Cyperus papyrus subsp. antiquorum (Willd.) Chiov. 
## 52613 Cyperus papyrus subsp. nyassicus Chiov. 
## ------------------------------</code></pre>
<pre class="r"><code>Papyrus &lt;- get_parents(Easplist, Papyrus)
summary(Papyrus, &quot;all&quot;)</code></pre>
<pre><code>## ------------------------------ 
## concept ID: 206 
## view ID: 1 
## level: species 
## parent: 53660 
## 
## # accepted name: 
## 206 Cyperus papyrus L. 
## 
## # synonyms (2): 
## 52612 Cyperus papyrus subsp. antiquorum (Willd.) Chiov. 
## 52613 Cyperus papyrus subsp. nyassicus Chiov. 
## ------------------------------ 
## concept ID: 53660 
## view ID: 2 
## level: genus 
## parent: 54607 
## 
## # accepted name: 
## 53660 Cyperus  
## ------------------------------ 
## concept ID: 54607 
## view ID: 2 
## level: family 
## parent: none 
## 
## # accepted name: 
## 54607 Cyperaceae  
## ------------------------------</code></pre>
</div>
</div>
<div id="introduction-to-vegtable" class="section level1">
<h1><span class="header-section-number">3</span> Introduction to vegtable</h1>
<p>Objects of class <code>vegtable</code> are complex objects attempting to handle the most important information contained in vegetation-plot databases. They are defined in the homonymous package, while the species list will be required as a <code>taxlist</code> object.</p>
<p>As already mentioned, <code>S4</code> objects are composed by slots:</p>
<pre class="r"><code>library(vegtable)
showClass(&quot;vegtable&quot;)</code></pre>
<p>The information contained in the slot is the following:</p>
<ul>
<li><code>description</code> is containing the “metadata” of the database as a named character vector.</li>
<li><code>samples</code> is a column oriented table with the observations of species (as usage IDs) in plots and layers.</li>
<li><code>header</code> is a table containing information on the plots.</li>
<li><code>species</code> is the taxonmic list as <code>taxlist</code> object.</li>
<li><code>relations</code> are tables linked to categorical variables in slot <code>header</code> (called <code>popups</code> in <strong>Turboveg</strong>).</li>
<li><code>coverconvert</code> is a list with conversion tables among cover scales.</li>
</ul>
<div id="building-vegtable-objects" class="section level2">
<h2><span class="header-section-number">3.1</span> Building vegtable objects</h2>
<p>An empty object (prototype) can be generated by using the function <code>new</code>:</p>
<pre class="r"><code>Veg &lt;- new(&quot;vegtable&quot;)</code></pre>
<p>It is also possible to build an object from cross tables, assuming all species included in the table are accepted names:</p>
<pre class="r"><code>File &lt;- file.path(path.package(&quot;vegtable&quot;), &quot;Fujiwara_2014&quot;, &quot;samples.csv&quot;)
Fujiwara &lt;- read.csv(File, check.names=FALSE, stringsAsFactors=FALSE)
Fujiwara_veg &lt;-df2vegtable(Fujiwara, 1, 2)
summary(Fujiwara_veg)</code></pre>
</div>
<div id="example-data-set-1" class="section level2">
<h2><span class="header-section-number">3.2</span> Example data set</h2>
<p>The package <code>vegtable</code> also provides own data sets as examples. One of those examples is <code>dune_veg</code>, which contains the data sets <code>dune</code> and <code>dune.env</code> from the package <code>vegan</code>.</p>
<pre class="r"><code>data(dune_veg)
summary(dune_veg)</code></pre>
<p>Other example is <code>Kenya_veg</code>, which also represent a subset of the database <strong>SWEA-Dataveg</strong> (<a href="http://www.givd.info/ID/AF-00-006" title="SWEA-Dataveg">GIVD ID AF-00-006</a>).</p>
<pre class="r"><code>data(Kenya_veg)
summary(Kenya_veg)</code></pre>
<pre><code>## ## Metadata 
## db_name: Sweadataveg
## sp_list: Easplist
## dictionary: Swea
## object size: 9317.7 Kb 
## validity: TRUE 
## 
## ## Content 
## number of plots: 1946 
## variables in header: 34 
## number of relations: 3 
## 
## ## Species List 
## taxon names: 2302 
## taxon concepts: 1573 
## validity: TRUE</code></pre>
<p>As shown in the previous commands, the function <code>summary</code> displays a general overview of the object’s content, while it also runs a validity check. An additional display is offered by the function <code>vegtable_stat</code>:</p>
<pre class="r"><code>vegtable_stat(Kenya_veg)</code></pre>
<pre><code>## ## Metadata 
## db_name: Sweadataveg
## sp_list: Easplist
## dictionary: Swea
## object size: 9317.7 Kb 
## validity: TRUE 
## 
## ## Content 
## number of plots: 1946 
## variables in header: 34 
## number of relations: 3 
## 
## ## Species List 
## taxon names: 2302 
## taxon concepts: 1573 
## validity: TRUE 
## 
## REFERENCES 
## Primary references: 5
## 
## ## AREA 
## Area range (m^2): 150 - 1750
## &lt;1 m^2: 0%
## 1-&lt;10 m^2: 0%
## 10-&lt;100 m^2: 0%
## 100-&lt;1000 m^2: 2%
## 1000-&lt;10000 m^2: 1%
## &gt;=10000 m^2: 0%
## unknow: 97%
## 
## ## TIME 
## oldest: 1983 - youngest: 2014
## &lt;=1919: 0%
## 1920-1929: 0%
## 1930-1939: 0%
## 1940-1949: 0%
## 1950-1959: 0%
## 1960-1969: 0%
## 1970-1979: 0%
## 1980-1989: 36%
## 1990-1999: 31%
## 2000-2009: 2%
## 2010-2019: 1%
## unknow: 30%
## 
## ## DISTRIBUTION 
## KE: 100%
## 
## ## PERFORMANCE 
## 01: 83%
## 02: 17%
## 03: 0%
## 04: 0%
## 05: 0%
## 06: 0%
## 07: 0%
## 08: 0%
## 09: 0%
## 10: 0%
## 11: 0%
## 12: 0%</code></pre>
</div>
<div id="access-to-slots-1" class="section level2">
<h2><span class="header-section-number">3.3</span> Access to slots</h2>
<p>Some functions are provided for the access to slots of <code>vegtable</code> objects, namely <code>header</code> and <code>veg_relation</code>, <code>taxon_traits</code> and <code>taxon_views</code> (see the help documentation).</p>
<p>For a direct access of the content included in slot <code>header</code>, there are the methods <code>$</code> and <code>[</code>:</p>
<pre class="r"><code>summary(Kenya_veg$REFERENCE)
veg_relation(Kenya_veg, &quot;REFERENCE&quot;)[,1:3]</code></pre>
</div>
<div id="subsets-1" class="section level2">
<h2><span class="header-section-number">3.4</span> Subsets</h2>
<p>As a way to generate queries from <code>vegtable</code> objects, a method for the function <code>subset</code> is implemented as well. Following is the case of the data set <code>dune_veg</code> generating a subset with pasture plots.</p>
<pre class="r"><code>data(dune_veg)
pasture &lt;- subset(dune_veg, Use == &quot;Pasture&quot;)
summary(dune_veg)</code></pre>
<pre><code>## ## Metadata 
## object size: 20.4 Kb 
## validity: TRUE 
## 
## ## Content 
## number of plots: 20 
## variables in header: 6 
## number of relations: 0 
## 
## ## Species List 
## taxon names: 30 
## taxon concepts: 30 
## validity: TRUE</code></pre>
<pre class="r"><code>summary(pasture)</code></pre>
<pre><code>## ## Metadata 
## object size: 17.3 Kb 
## validity: TRUE 
## 
## ## Content 
## number of plots: 5 
## variables in header: 6 
## number of relations: 0 
## 
## ## Species List 
## taxon names: 23 
## taxon concepts: 23 
## validity: TRUE</code></pre>
</div>
<div id="cross-tables" class="section level2">
<h2><span class="header-section-number">3.5</span> Cross tables</h2>
<p>Most of the applications dealing with analysis of vegetation tables (e.g. the package <code>vegan</code>) will deal with cross tables rather than with column-oriented database lists. Therefore a function <code>crosstable</code> is defined for the conversion of <code>taxlist</code> objects to cross tables. Before building a cross table it will be recommended to transform the cover into percentage value by using the function <code>transform</code>.</p>
<pre class="r"><code>pasture &lt;- transform(pasture, to=&quot;Cover&quot;, rule=&quot;middle&quot;)

Cross &lt;- crosstable(Cover ~ ReleveID + AcceptedName, pasture, max,
    na_to_zero=TRUE)
Cross</code></pre>
<p>The first argument in the function is the formula <code>y ~ x1 + x2 + ... + xn</code>, where:</p>
<ul>
<li><code>y</code> is the cover value (a column in slot <code>samples</code>).</li>
<li><code>x1</code> is the plot ID or a grouping value from slot <code>header</code> which will be used as columns in the cross table.</li>
<li><code>x2</code> is the output for species (either <code>TaxonName</code> or <code>AcceptedName</code>).</li>
<li><code>x3</code> to <code>xn</code> are additional information for the rows, such as layer, etc.</li>
</ul>
<p>The second argument is the <code>vegtable</code> object and the third is a function, which will be applied in the case of multiple values in a cell (e.g. multiple records of a species within a plot).</p>
<p>Note that there is also a method dealing with class <code>data.frame</code> (see the help documentation).</p>
<pre class="r"><code>dune_veg &lt;- transform(dune_veg, to=&quot;Cover&quot;, rule=&quot;middle&quot;)

Cross_use &lt;- crosstable(Cover ~ Use + AcceptedName, dune_veg, sum,
    na_to_zero=TRUE)
Cross_use</code></pre>
<p>While the previous commands show statistics of groups in a vegetation table, it is also possible to write a presence-absence table:</p>
<pre class="r"><code>Cross_pa &lt;- crosstable(Cover ~ ReleveID + AcceptedName, pasture, function(x) 1,
    na_to_zero=TRUE)
Cross_pa</code></pre>
</div>
</div>
<div id="import-from-turboveg" class="section level1">
<h1><span class="header-section-number">4</span> Import from Turboveg</h1>
<p>The original task of <code>vegtable</code> was the import of <strong>Turboveg</strong> databases in R. Thus one of the oldest functions in the package is <code>tv2vegtable</code>.</p>
<pre class="r"><code>tv_home &lt;- file.path(path.package(&quot;vegtable&quot;), &quot;tv_data&quot;)
Fujiwara &lt;- tv2vegtable(&quot;Fujiwara_2014&quot;, tv_home)</code></pre>
<pre><code>## zero values will be replaced by NAs</code></pre>
<pre class="r"><code>summary(Fujiwara)</code></pre>
<pre><code>## ## Metadata 
## db_name: Fujiwara_2014
## sp_list: Fujiwara_sp
## dictionary: Swea
## object size: 356.3 Kb 
## validity: TRUE 
## 
## ## Content 
## number of plots: 56 
## variables in header: 29 
## number of relations: 2 
## 
## ## Species List 
## taxon names: 301 
## taxon concepts: 254 
## validity: TRUE</code></pre>
<div class="figure">
<img src="images/Turboveg_Data.png" alt="Screenshot of Kenyan data set displayed in Turboveg" />
<p class="caption">Screenshot of Kenyan data set displayed in <strong>Turboveg</strong></p>
</div>
<p>In the case there is an error message produced by inconsistent data structure, there is the possibility of importing the data as a list for further inspection.</p>
<pre class="r"><code>Fujiwara_list &lt;- tv2vegtable(&quot;Fujiwara_2014&quot;, tv_home, output=&quot;list&quot;)</code></pre>
</div>
<div id="export-to-juice" class="section level1">
<h1><span class="header-section-number">5</span> Export to Juice</h1>
<p>Export of data for <strong>Juice</strong> follows a similar procedure as for cross tables.</p>
<pre class="r"><code>write_juice(Fujiwara, &quot;RiftValley&quot;,
    COVER_CODE ~ ReleveID + AcceptedName + LAYER,
    header=c(&quot;TABLE_NR&quot;,&quot;NR_IN_TAB&quot;,&quot;ALTITUDE&quot;,&quot;INCLINATIO&quot;,&quot;EXPOSITION&quot;,
        &quot;COMM_TYPE&quot;),
    FUN=paste0)</code></pre>
<p>Besides the <code>vegtable</code> object, the most important elements to export are:</p>
<ul>
<li><code>formula</code> indicating how to construct the cross table.</li>
<li><code>header</code> to show which variables should be exported for the head data.</li>
<li><code>coords</code> with the names of coordinates, if present.</li>
<li><code>FUN</code> the function used for aggregate multiple records.</li>
</ul>
<p>The values for <code>coords</code> should be as decimal degrees and in the spatial system <strong>WGS 84</strong>. In Juice such information will be included in the header data as columns <strong>deg_lon</strong> and <strong>deg_lat</strong>, allowing the display of plots in <strong>Google Earth</strong>. The previous command has generated two files, namely <strong>RiftValley_table.txt</strong> and <strong>RiftValley_header.txt</strong>.</p>
<p>For importing the table, you may follow the steps:</p>
<ul>
<li>Open <strong>Juice</strong></li>
<li>In menu <code>File -&gt; Import -&gt; Table -&gt; From Spreadsheet File (e.g. EXCEL Table)</code></li>
<li>Browse to <strong>RiftValley_table.txt</strong> and <code>Open</code></li>
<li>In the last step, select the option <code>Braun-Blanquet Codes</code> and <code>Finish</code></li>
<li>Finally, save the new file</li>
</ul>
<div class="figure">
<img src="images/Juice_table.png" alt="The Kenyan data set displayed in Juice" />
<p class="caption">The Kenyan data set displayed in <strong>Juice</strong></p>
</div>
<p>Now for the head:</p>
<ul>
<li>In menu <code>File -&gt; Import -&gt; Header Data -&gt; From Comma Delimited File</code></li>
<li>Browse to <strong>RiftValley_header.txt</strong> and <code>Open</code></li>
</ul>
<div class="figure">
<img src="images/Juice_header.png" alt="Display of header data in Juice" />
<p class="caption">Display of header data in <strong>Juice</strong></p>
</div>
</div>
<div id="export-locations-to-google-earth" class="section level1">
<h1><span class="header-section-number">6</span> Export Locations to Google Earth</h1>
<p>In those cases where vegetation data is geo-referenced, it is also possible to include spatial reference systems different than <strong>longlat WGS 84</strong>, which will be reprojected by the function.</p>
<pre class="r"><code>vegtable2kml(Fujiwara, &quot;RiftValley.kml&quot;)</code></pre>
<div class="figure">
<img src="images/Fujiwara_map.jpg" alt="Location of plots displayed in Google Earth" />
<p class="caption">Location of plots displayed in <strong>Google Earth</strong></p>
</div>
<p>Then, hopefully you enjoyed the session and did not get too much error messages. <br/> <br/></p>
<p><strong>Aknowledgements:</strong> This workshop was supported by the project <a href="https://www.wetlands-africa.de">GlobE-wetlands</a>.</p>
<p><img src="images/CombinedLogos.png" height="100px" width="496px" /></p>
<p><br/></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
